{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/dep.ts", "../src/effect.ts", "../src/baseHandlers.ts", "../src/reactive.ts"],
  "sourcesContent": ["import { effect } from './effect'\r\nimport { reactive } from './reactive'\r\n\r\nexport { effect, reactive }\r\n", "export const isObject = (val: unknown): val is Record<any, any> =>\n  typeof val !== null && typeof val === 'object'\n\nexport const isFunction = (fn: unknown) => typeof fn === 'function'\n\nexport const isArray = Array.isArray\n", "import { ReactiveEffect } from './effect'\n\nexport type Dep = Set<ReactiveEffect>\n\nexport const createDep = (effects?: ReactiveEffect[]): Dep => {\n  const dep = new Set<ReactiveEffect>(effects)\n  return dep\n}\n", "import { isFunction, isArray } from '@vue/shared'\nimport { createDep, Dep } from './dep'\n\nlet activeEffect: ReactiveEffect | undefined\n\n/**\n * \u4F9D\u8D56\u6536\u96C6\n */\nexport class ReactiveEffect<T = any> {\n  constructor(public fn: () => T) {\n    activeEffect = this as ReactiveEffect\n    this.fn = fn\n  }\n  run() {\n    this.fn()\n  }\n}\n\n/**\n * \u526F\u4F5C\u7528\u51FD\u6570 \u6B64\u51FD\u6570\u4F9D\u8D56\u7684\u6570\u636E\u53D8\u5316\u4E86 \u4F1A\u91CD\u65B0\u6267\u884C\n * @param fn Function\n */\nexport function effect<T = any>(fn: () => T) {\n  if (!isFunction) console.warn('effect \u4F20\u5165\u5FC5\u987B\u662F\u4E00\u4E2A\u51FD\u6570\uFF01')\n  const _effect = new ReactiveEffect(fn)\n  _effect.run()\n}\n\n// \u5B58\u653E\u4F9D\u8D56\u6536\u96C6\u6570\u636E {target -> key -> dep}\nconst targetMap = new WeakMap<any, Map<any, Dep>>()\n\n/**\n * \u4F9D\u8D56\u6536\u96C6\n * @param target object \u6536\u96C6\u76EE\u6807\n * @param key unknown \u76EE\u6807\u5143\u7D20\n */\nexport function track(target: object, key: unknown) {\n  let depsMap = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n  let dep = depsMap.get(key)\n  if (!dep) {\n    depsMap.set(key, (dep = createDep()))\n  }\n  trackEffects(dep)\n}\n\n/**\n * \u5B58\u653E\u6240\u6709\u7684 effect\n * @param dep Dep\n */\nexport function trackEffects(dep: Dep) {\n  // \u662F\u5426\u9700\u8981\u5B58\u653Edep\n  // \u5B58\u653E\u8FC7\u7684\u4E0D\u9700\u8981\u8FFD\u52A0\n  let shouldTrack = false\n  shouldTrack = !dep.has(activeEffect!)\n  if (shouldTrack) {\n    dep.add(activeEffect!)\n  }\n}\n\n/**\n * \u89E6\u53D1\u4F9D\u8D56\n * @param target\n * @param key\n */\nexport function trigger(target: object, key: unknown) {\n  const depsMap = targetMap.get(target)\n  // \u770B\u6709\u6CA1\u6709\u6CA1\u8FFD\u8E2A\u8FC7 \u6CA1\u6709\u76F4\u63A5\u4E0D\u505A\u64CD\u4F5C\n  if (!depsMap) return\n  // \u521B\u5EFAdep\u96C6\u5408deps\n  const deps: (Dep | undefined)[] = []\n  const dep = depsMap.get(key)\n  deps.push(dep)\n\n  if (deps.length === 1) {\n    deps[0] && triggerEffects(deps[0])\n  } else {\n    const effects: ReactiveEffect[] = []\n    for (const dep of deps) {\n      dep && effects.push(...dep)\n    }\n    triggerEffects(createDep(effects))\n  }\n}\n\nexport function triggerEffects(dep: Dep | ReactiveEffect[]) {\n  const effects = isArray(dep) ? dep : [...dep]\n  for (const effect of effects) {\n    triggerEffect(effect)\n  }\n}\n\n/**\n * \u91CD\u65B0\u6267\u884Ceffect\n * @param effect\n */\nfunction triggerEffect(effect: ReactiveEffect) {\n  effect.run()\n}\n", "import { track, trigger } from './effect'\n\nexport const mutableHandlers: ProxyHandler<object> = {\n  get(target, key, receiver) {\n    // \u6536\u96C6\u4F9D\u8D56\n    track(target, key)\n    return Reflect.get(target, key, receiver)\n  },\n  set(target, key, value) {\n    const result = Reflect.set(target, key, value)\n    // \u89E6\u53D1\u4F9D\u8D56\n    trigger(target, key)\n    return result\n  }\n}\n", "import { isObject } from '@vue/shared'\n\nimport { mutableHandlers } from './baseHandlers'\n\n/**\n * \u5C06\u5BF9\u8C61\u53D8\u4E3A\u54CD\u5E94\u5F0F proxy\n * @param target\n * @returns\n */\nexport function reactive(target: any) {\n  return createReactiveObject(target)\n}\n\nfunction createReactiveObject(target: any) {\n  if (!isObject) {\n    console.warn('\u54CD\u5E94\u5F0F\u5143\u7D20\u5FC5\u987B\u662F\u4E00\u4E2A\u5BF9\u8C61\uFF01')\n    return target\n  }\n  const proxy = new Proxy(target, mutableHandlers)\n  return proxy\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAO,MAAM,WAAW,CAAC,QACvB,OAAO,QAAQ,QAAQ,OAAO,QAAQ;AAEjC,MAAM,aAAa,CAAC,OAAgB,OAAO,OAAO;AAElD,MAAM,UAAU,MAAM;;;ACDtB,MAAM,YAAY,CAAC,YAAoC;AAC5D,UAAM,MAAM,IAAI,IAAoB,OAAO;AAC3C,WAAO;AAAA,EACT;;;ACJA,MAAI;AAKG,MAAM,iBAAN,MAA8B;AAAA,IACnC,YAAmB,IAAa;AAAb;AACjB,qBAAe;AACf,WAAK,KAAK;AAAA,IACZ;AAAA,IACA,MAAM;AACJ,WAAK,GAAG;AAAA,IACV;AAAA,EACF;AAMO,WAAS,OAAgB,IAAa;AAC3C,QAAI,CAAC;AAAY,cAAQ,KAAK,qEAAmB;AACjD,UAAM,UAAU,IAAI,eAAe,EAAE;AACrC,YAAQ,IAAI;AAAA,EACd;AAGA,MAAM,YAAY,oBAAI,QAA4B;AAO3C,WAAS,MAAM,QAAgB,KAAc;AAClD,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC,SAAS;AACZ,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC7C;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAI,CAAC,KAAK;AACR,cAAQ,IAAI,KAAM,MAAM,UAAU,CAAE;AAAA,IACtC;AACA,iBAAa,GAAG;AAAA,EAClB;AAMO,WAAS,aAAa,KAAU;AAGrC,QAAI,cAAc;AAClB,kBAAc,CAAC,IAAI,IAAI,YAAa;AACpC,QAAI,aAAa;AACf,UAAI,IAAI,YAAa;AAAA,IACvB;AAAA,EACF;AAOO,WAAS,QAAQ,QAAgB,KAAc;AACpD,UAAM,UAAU,UAAU,IAAI,MAAM;AAEpC,QAAI,CAAC;AAAS;AAEd,UAAM,OAA4B,CAAC;AACnC,UAAM,MAAM,QAAQ,IAAI,GAAG;AAC3B,SAAK,KAAK,GAAG;AAEb,QAAI,KAAK,WAAW,GAAG;AACrB,WAAK,CAAC,KAAK,eAAe,KAAK,CAAC,CAAC;AAAA,IACnC,OAAO;AACL,YAAM,UAA4B,CAAC;AACnC,iBAAWA,QAAO,MAAM;AACtB,QAAAA,QAAO,QAAQ,KAAK,GAAGA,IAAG;AAAA,MAC5B;AACA,qBAAe,UAAU,OAAO,CAAC;AAAA,IACnC;AAAA,EACF;AAEO,WAAS,eAAe,KAA6B;AAC1D,UAAM,UAAU,QAAQ,GAAG,IAAI,MAAM,CAAC,GAAG,GAAG;AAC5C,eAAWC,WAAU,SAAS;AAC5B,oBAAcA,OAAM;AAAA,IACtB;AAAA,EACF;AAMA,WAAS,cAAcA,SAAwB;AAC7C,IAAAA,QAAO,IAAI;AAAA,EACb;;;AClGO,MAAM,kBAAwC;AAAA,IACnD,IAAI,QAAQ,KAAK,UAAU;AAEzB,YAAM,QAAQ,GAAG;AACjB,aAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,IAC1C;AAAA,IACA,IAAI,QAAQ,KAAK,OAAO;AACtB,YAAM,SAAS,QAAQ,IAAI,QAAQ,KAAK,KAAK;AAE7C,cAAQ,QAAQ,GAAG;AACnB,aAAO;AAAA,IACT;AAAA,EACF;;;ACLO,WAAS,SAAS,QAAa;AACpC,WAAO,qBAAqB,MAAM;AAAA,EACpC;AAEA,WAAS,qBAAqB,QAAa;AACzC,QAAI,CAAC,UAAU;AACb,cAAQ,KAAK,gFAAe;AAC5B,aAAO;AAAA,IACT;AACA,UAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAC/C,WAAO;AAAA,EACT;",
  "names": ["dep", "effect"]
}
